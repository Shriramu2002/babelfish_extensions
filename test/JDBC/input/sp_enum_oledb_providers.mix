-- tsql
-- Executing sp_enum_oledb_providers without tds_fdw extension (should not return anything)
EXEC sp_enum_oledb_providers
GO

-- Creating a simple login which has lesser privilege than sysadmin role
create login linked_server_login_862 with password = 'password_862'
GO

-- tsql    user=linked_server_login_862    password=password_862
-- Executing sp_enum_oledb_providers stored procedure without system admin privilege (should throw error)
EXEC sp_enum_oledb_providers
GO

-- psql
-- Need to terminate active session before cleaning up the login
SELECT pg_terminate_backend(pid) FROM pg_stat_get_activity(NULL) 
WHERE sys.suser_name(usesysid) = 'linked_server_login_862' AND backend_type = 'client backend' AND usesysid IS NOT NULL;
GO

-- tsql
DROP LOGIN linked_server_login_862
GO